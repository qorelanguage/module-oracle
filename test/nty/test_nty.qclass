#! /usr/bin/env qore
# -*- mode: qore; indent-tabs-mode: nil -*-

%new-style
%enable-all-warnings
%require-types
%strict-args

%requires QUnit

public class NtyTest inherits QUnit::Test {
    private {
        Datasource ds;
    }

    constructor(string testName, any args) : Test(testName, "1.1", \args, ("connstr": "c,conn=s")) {
/*
        string connstr;
        switch (gethostname()) {
            case /^quasar/: connstr = "oracle:omquser/omquser@el7"; break;
            case /^qube/: connstr = "oracle:omquser2/omquser2@qube"; break;
            case /^el6/:
            case /^quark/: connstr = "oracle:omquser/omquser@el6"; break;
            case /^stimpy/: connstr = "oracle:omqtest/omqtest@stimpy"; break;
            default: connstr = "oracle:omquser/omquser@xbox";
        }
        ds = new Datasource(connstr);
        ds.open();
*/
        if (!m_options.connstr)
            m_options.connstr = ENV.QORE_DB_CONNSTR_ORACLE;
        ds = new Datasource(m_options.connstr);
        if (ds.getDriverName() != "oracle")
            throw "ORACLE-ERROR", sprintf("cannot execute oracle test on a connection using driver %y", ds.getDriverName());
        ds.open();
    }
}
